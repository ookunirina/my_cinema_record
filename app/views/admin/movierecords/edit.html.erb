<% content_for(:title, @movierecord.title) %>
<div class="container">
  <div class="row">
    <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2">
      <h1><%= t '.title' %></h1>
      <%= form_with model: @movierecord, url: admin_movierecord_path(@movierecord), local: true do |f| %>
        <%= render 'shared/error_messages', object: f.object %>
        <div class="form-group">
          <%= f.label :title %>
          <%= f.text_field :title, class: 'form-control', list: 'movie-titles' %>
    <datalist id="movie-titles">
    <!-- ここに映画のタイトルが動的に追加されます -->
    </datalist>
  </div>
          
        <div class="form-group">
          <%= f.label :image_url %>
          <%= f.file_field :image_url, class: 'form-control mb-3', accept: 'image/*', id: 'image-input' %>
          <%= f.hidden_field :image_url_cache %>
        </div>
        <div class='mt-3 mb-3'>
          <%= image_tag @movierecord.image_url.url,
                        id: 'preview',
                        size: '300x200' %>
        </div>
        <div class="form-group">
        <%= f.label :viewing_style %>
        <br>
        <%= f.radio_button :viewing_style, "映画館" %>
        <%= f.label :viewing_style_映画館, "映画館" %>
        <%= f.radio_button :viewing_style, "動画配信サイト" %>
        <%= f.label :viewing_style_動画配信サイト, "動画配信サイト" %>
        <%= f.radio_button :viewing_style, "DVDorBlu-ray" %>
        <%= f.label :viewing_style_DVDorブルーレイ, "DVDorBlu-ray" %>
        </div>
        <div class="form-group">
            <%= f.label :tag %>
            <%= f.text_field :tag, value: @tag_list, class: 'form-control' %>
        </div> 
        <h5>総合評価</h5>
        <div class="movierecord_form">
         <%= f.radio_button :star, 5 ,id: 'star1'%>
         <label for="star1"><span class="text">最高</span>★</label>
         <%= f.radio_button :star, 4 ,id: 'star2'%>
         <label for="star2"><span class="text">良い</span>★</label>
         <%= f.radio_button :star, 3 ,id: 'star3'%>
         <label for="star3"><span class="text">普通</span>★</label>
         <%= f.radio_button :star, 2 ,id: 'star4'%>
         <label for="star4"><span class="text">悪い</span>★</label>
         <%= f.radio_button :star, 1 ,id: 'star5'%>
         <label for="star5"><span class="text">最悪</span>★</label>
        </div>
        <div class="form-group pt-4">
          <%= f.label :review %>
          <%= f.text_area :review, class: 'form-control', rows: 10 %>
        </div>
        <%= f.submit class: 'btn btn-primary' %>
      <% end %>
    </div>
  </div>
</div>

<script>
  function searchMovieTitles(query) {
    const apiKey = '<%= ENV["API_KEY"] %>';
    const url = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&language=ja-JP&query=${query}`;

    return fetch(url)
      .then(response => response.json())
      .then(data => data.results)
      .catch(error => console.error(error));
  }

  document.addEventListener('DOMContentLoaded', function() {
    const titleInput = document.querySelector('input[name="movierecord[title]"]');
    const dataList = document.getElementById('movie-titles');

    titleInput.addEventListener('input', function() {
      if (titleInput.value.length >= 2) {
        searchMovieTitles(titleInput.value).then(titles => {
          dataList.innerHTML = ''; // 以前の検索結果を削除
          for (const movie of titles) {
            const option = document.createElement('option');
            option.value = movie.title;
            dataList.appendChild(option);
          }
        });
      }
    });
  });
</script>